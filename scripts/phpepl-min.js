(function(e,t,n,r){"use strict";if(!n)throw new Error("jquery not found");if(!e.ace)throw new Error("ace not found");var i=e.ace,s="http://localhost:8888/eval/index.php",o="http://phpepl.cloudcontrolled.com/eval/index.php",u,a=function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),i;t=t>12?t-12:t;t=t===0?12:t;i=[t,n,r].join(":");return i},f=function(e){var t=!!arguments[1],r=n(".output span");r.html(e).removeClass("error");t&&r.addClass("error");n(".spinner").fadeOut("fast");n(".timestamp").find("span").html(a())},l=function(e){n(".ace_gutter-cell").each(function(t){if(Number(n(this).html())===e){n(this).addClass("error-gutter");return}})},c=function(e){var t=e,r=["\n",/<br \/>/g,/<b>/g,/<\/b>/g,/(Fatal error: +)/g],i,s,o,u;n.each(r,function(e,n){t=t.replace(n,"")});i=t.split("in");s=i[0].trim();i=t.split("on");o=i[1].trim();t=(s+" on "+o).trim();u=o.split(" ");u=Number(u[1]);return[t,u]},h=function(){var t=u.getValue();if(!t.length){f("Please supply some code...");return}n(".spinner").fadeIn("fast");e.mixpanel.track("Code Run",{code:t});n.ajax({type:"POST",url:o,data:{code:t},dataType:"json",success:function(e){if(!e)return;var t=e.result,n=e.error,r;if(n){l(n.line);r="Line "+n.line+": "+n.message;f(r,!0);return}f(t)},error:function(t){var n=c(t.responseText);f(n[0],!0);l(n[1]);e.mixpanel.track("Error",{error:t.responseText})}})},p=function(){if(e.localStorage){var t=u.getValue();localStorage.setItem("code",t);n(".timestamp").find("span").html("Code Saved!");e.mixpanel.track("Code Saved")}},d=function(){if(e.localStorage){var t=localStorage.getItem("code"),n=t?t:'echo "PHPepl";';u.setValue(n)}};n(function(){u=i.edit("editor");u.setTheme("ace/theme/textmate");u.getSession().setMode("ace/mode/php");u.getSession().setUseSoftTabs(!0);u.getSession().setTabSize(2);u.setShowPrintMargin(!1);d();n(".submit button").click(function(){h()});n(t).keydown(function(t){if(t.which===13&&(t.ctrlKey||t.metaKey)){h();t.preventDefault();e.mixpanel.track("Run Shortcut")}if(t.which===83&&(t.ctrlKey||t.metaKey)){p();t.preventDefault();e.mixpanel.track("Save Shortcut")}});n(e).unload(function(){p()})})})(window,document,window.jQuery);